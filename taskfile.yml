version: '3'

tasks:
  install:
    desc: "Instalar dependÃªncias, rodar migrations e preparar ambiente"
    cmds:
      - composer install
      - php yii migrate --interactive=0
      - bash scripts/ajusta_permissoes_projeto.sh
      - |
        echo ""
        echo "âœ… InstalaÃ§Ã£o concluÃ­da com sucesso!"
        echo ""
        echo "ğŸŒ Acesse a aplicaÃ§Ã£o em:  http://localhost:8080"
        echo "ğŸ—„ï¸  Acesse o phpMyAdmin em: http://localhost:8081"
        echo ""
        echo "ğŸ”‘ Credenciais iniciais:"
        echo "   UsuÃ¡rio Admin: admin@teste.com"
        echo "   Senha: admin123"
        echo ""
        echo "ğŸ’¾ Banco de dados disponÃ­vel no host local em:"
        echo "   Host: 127.0.0.1"
        echo "   Porta: 8236"
        echo "   UsuÃ¡rio: expenses_user"
        echo "   Senha: expenses_pass"
        echo ""
        echo "â¡ï¸  Para rodar os testes automatizados:"
        echo "   docker exec -it expenses_app task test"
        echo ""

  migrate:
    desc: "Rodar migrations"
    cmds:
      - php yii migrate --interactive=0

  reset-db:
    desc: "Resetar banco (drop + migrate)"
    cmds:
      - php yii migrate/down --all --interactive=0
      - php yii migrate --interactive=0
      - |
        echo ""
        echo "âœ… Banco recriado e migrations aplicadas."
        echo "VocÃª pode agora rodar novamente o 'task install' se precisar repopular dados."
        echo ""

  test:
    desc: "Rodar testes automatizados (Codeception)"
    cmds:
      - vendor/bin/codecept run api
